<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UptimeRobot Dashboard</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #1e1e1e;
            color: #e0e0e0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #444;
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #0078d4;
        }
        .status-summary {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }
        .status-card {
            flex: 1;
            margin: 0 10px;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            background-color: #2d2d2d;
            text-align: center;
        }
        .status-card.up {
            border-left: 5px solid #4caf50;
        }
        .status-card.down {
            border-left: 5px solid #f44336;
        }
        .status-card.paused {
            border-left: 5px solid #ff9800;
        }
        .status-card h3 {
            margin-top: 0;
            font-size: 16px;
            color: #aaa;
        }
        .status-card .count {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }
        .monitors-list {
            background-color: #2d2d2d;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .monitors-list table {
            width: 100%;
            border-collapse: collapse;
        }
        .monitors-list th {
            text-align: left;
            padding: 12px 15px;
            background-color: #333;
            font-weight: 600;
        }
        .monitors-list td {
            padding: 12px 15px;
            border-top: 1px solid #444;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-up { background-color: #4caf50; }
        .status-down { background-color: #f44336; }
        .status-paused { background-color: #ff9800; }
        .refresh-btn {
            background-color: #0078d4;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .refresh-btn:hover {
            background-color: #005a9e;
        }
        .error-message {
            background-color: #5e0000;
            color: #ff9999;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }
        .loading {
            text-align: center;
            padding: 30px;
            font-size: 18px;
            color: #aaa;
        }
        .uptime-bar {
            height: 8px;
            background-color: #444;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }
        .uptime-value {
            height: 100%;
            background-color: #4caf50;
        }
        .last-check {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }
        .last-updated {
            text-align: right;
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }
        #debugInfo {
            margin-top: 20px;
            padding: 10px;
            background-color: #333;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">UptimeRobot Integration</div>
            <button id="refreshBtn" class="refresh-btn">Refresh Data</button>
        </div>

        <div id="errorMessage" class="error-message"></div>

        <div id="dashboard">
            <div class="status-summary" id="statusSummary">
                <div class="status-card up">
                    <h3>Up</h3>
                    <div class="count" id="upCount">0</div>
                </div>
                <div class="status-card down">
                    <h3>Down</h3>
                    <div class="count" id="downCount">0</div>
                </div>
                <div class="status-card paused">
                    <h3>Paused</h3>
                    <div class="count" id="pausedCount">0</div>
                </div>
                <div class="status-card">
                    <h3>Total Monitors</h3>
                    <div class="count" id="totalCount">0</div>
                </div>
            </div>

            <div class="monitors-list" id="monitorsList">
                <div id="loading" class="loading">Loading monitors data...</div>
                <table id="monitorsTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>Monitor Name</th>
                            <th>Type</th>
                            <th>Status</th>
                            <th>Uptime</th>
                            <th>Last Check</th>
                        </tr>
                    </thead>
                    <tbody id="monitorsTableBody">
                    </tbody>
                </table>
                <div class="last-updated" id="lastUpdated"></div>
            </div>
            
            <div id="debugInfo"></div>
        </div>
    </div>

    <script>
        // Use sample data for demonstration if we can't connect to the API
        const SAMPLE_DATA = {
            "stat": "ok",
            "pagination": {
                "offset": 0,
                "limit": 50,
                "total": 2
            },
            "monitors": [
                {
                    "id": 777749809,
                    "friendly_name": "Demo Website",
                    "url": "http://www.example.com",
                    "type": 1,
                    "sub_type": "",
                    "keyword_type": "",
                    "keyword_value": "",
                    "http_username": "",
                    "http_password": "",
                    "port": "",
                    "interval": 300,
                    "status": 2,
                    "all_time_uptime_ratio": 99.98,
                    "average_response": 187,
                    "last_check": Math.floor(Date.now() / 1000) - 180
                },
                {
                    "id": 777712827,
                    "friendly_name": "Demo API",
                    "url": "http://api.example.com",
                    "type": 1,
                    "sub_type": "",
                    "keyword_type": "",
                    "keyword_value": "",
                    "http_username": "",
                    "http_password": "",
                    "port": "",
                    "interval": 60,
                    "status": 2,
                    "all_time_uptime_ratio": 99.95,
                    "average_response": 142,
                    "last_check": Math.floor(Date.now() / 1000) - 60
                }
            ]
        };
        
        // Status and Type Mappings
        const STATUS_MAP = {
            0: { text: 'Paused', class: 'status-paused' },
            1: { text: 'Not checked yet', class: 'status-paused' },
            2: { text: 'Up', class: 'status-up' },
            8: { text: 'Seems Down', class: 'status-down' },
            9: { text: 'Down', class: 'status-down' }
        };
        
        const TYPE_MAP = {
            1: 'HTTP(S)',
            2: 'Keyword',
            3: 'Ping',
            4: 'Port',
            5: 'Heartbeat'
        };

        // DOM Elements
        const errorMessage = document.getElementById('errorMessage');
        const refreshBtn = document.getElementById('refreshBtn');
        const loading = document.getElementById('loading');
        const monitorsTable = document.getElementById('monitorsTable');
        const monitorsTableBody = document.getElementById('monitorsTableBody');
        const upCount = document.getElementById('upCount');
        const downCount = document.getElementById('downCount');
        const pausedCount = document.getElementById('pausedCount');
        const totalCount = document.getElementById('totalCount');
        const lastUpdated = document.getElementById('lastUpdated');
        const debugInfo = document.getElementById('debugInfo');

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', fetchMonitors);

        // Event Listeners
        refreshBtn.addEventListener('click', fetchMonitors);

        // Function to fetch monitors data
        function fetchMonitors() {
            // Reset UI
            errorMessage.style.display = 'none';
            loading.style.display = 'block';
            monitorsTable.style.display = 'none';
            
            // For debug purposes
            debugInfo.style.display = 'none';
            debugInfo.textContent = 'Debug Information:\n';
            
            // Get current timestamp for debugging
            debugInfo.textContent += `Time: ${new Date().toISOString()}\n`;
            
            // Use Sample Data (remove this in production)
            renderSampleData();
            
            // The following code can be uncommented if you want to attempt a real connection
            // to the UptimeRobot API, but it likely won't work due to CORS restrictions
            
            /*
            // API Key - Read Only
            const API_KEY = 'ur2875017-118b6389ec2262a9135b7929';
            
            try {
                // Attempt to fetch using a CORS proxy
                fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent('https://api.uptimerobot.com/v2/getMonitors?api_key=' + API_KEY + '&format=json&all_time_uptime_ratio=1')}`)
                    .then(response => {
                        debugInfo.textContent += `Response status: ${response.status}\n`;
                        return response.text();
                    })
                    .then(text => {
                        debugInfo.textContent += `Response text: ${text.substring(0, 100)}...\n`;
                        try {
                            const data = JSON.parse(text);
                            if (data && data.stat === 'ok') {
                                renderMonitors(data.monitors);
                                updateLastUpdated();
                            } else {
                                debugInfo.textContent += `API Error: ${JSON.stringify(data)}\n`;
                                throw new Error('API returned error status');
                            }
                        } catch (e) {
                            debugInfo.textContent += `Parse error: ${e.message}\n`;
                            throw e;
                        }
                    })
                    .catch(error => {
                        debugInfo.textContent += `Fetch error: ${error.message}\n`;
                        // Fall back to sample data
                        renderSampleData();
                    });
            } catch (e) {
                debugInfo.textContent += `Exception: ${e.message}\n`;
                // Fall back to sample data
                renderSampleData();
            }
            */
        }
        
        // Function to render sample data
        function renderSampleData() {
            showInfo('Using sample data for demonstration');
            renderMonitors(SAMPLE_DATA.monitors);
            updateLastUpdated();
        }

        // Function to render monitors data
        function renderMonitors(monitors) {
            if (!monitors || !Array.isArray(monitors)) {
                showError('Invalid data format received from API');
                return;
            }
            
            // Clear table
            monitorsTableBody.innerHTML = '';
            
            // Count different statuses
            let upCounter = 0;
            let downCounter = 0;
            let pausedCounter = 0;
            
            // Process and display each monitor
            monitors.forEach(monitor => {
                // Update counters
                if (monitor.status === 2) upCounter++;
                else if (monitor.status === 8 || monitor.status === 9) downCounter++;
                else pausedCounter++;
                
                // Create table row
                const row = document.createElement('tr');
                
                // Format last check time
                let lastCheckFormatted = 'N/A';
                if (monitor.last_check) {
                    const lastCheck = new Date(monitor.last_check * 1000);
                    lastCheckFormatted = lastCheck.toLocaleString();
                }
                
                // Calculate uptime percentage
                const uptimePercent = parseFloat(monitor.all_time_uptime_ratio) || 0;
                
                // Build row content
                row.innerHTML = `
                    <td>${monitor.friendly_name}</td>
                    <td>${TYPE_MAP[monitor.type] || 'Unknown'}</td>
                    <td>
                        <span class="status-indicator ${STATUS_MAP[monitor.status].class}"></span>
                        ${STATUS_MAP[monitor.status].text}
                    </td>
                    <td>
                        <div>${uptimePercent.toFixed(2)}%</div>
                        <div class="uptime-bar">
                            <div class="uptime-value" style="width: ${uptimePercent}%"></div>
                        </div>
                    </td>
                    <td>
                        <div>${lastCheckFormatted}</div>
                        <div class="last-check">Response: ${monitor.average_response || 'N/A'} ms</div>
                    </td>
                `;
                
                monitorsTableBody.appendChild(row);
            });
            
            // Update summary counters
            upCount.textContent = upCounter;
            downCount.textContent = downCounter;
            pausedCount.textContent = pausedCounter;
            totalCount.textContent = monitors.length;
            
            // Show table
            monitorsTable.style.display = 'table';
            loading.style.display = 'none';
        }

        // Function to display errors
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            debugInfo.style.display = 'block';
        }
        
        // Function to display info message
        function showInfo(message) {
            debugInfo.textContent += message + '\n';
        }

        // Function to update last updated timestamp
        function updateLastUpdated() {
            const now = new Date();
            lastUpdated.textContent = `Last updated: ${now.toLocaleString()}`;
        }

        // Auto-refresh data every 5 minutes
        setInterval(fetchMonitors, 300000);
    </script>
</body>
</html>
